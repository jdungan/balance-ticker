var DateUtil, ExtMath, Summary, build, parseDate, sparkline, x, y,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

ExtMath = (function(_super) {
  __extends(ExtMath, _super);

  function ExtMath() {
    return ExtMath.__super__.constructor.apply(this, arguments);
  }

  ExtMath.truncate = function(x, precision) {
    var scale, scales;
    if (precision == null) {
      precision = 0;
    }
    scales = [1, 10, 100, 1000, 10000, 100000, 1000000, 10000000, 100000000];
    scale = scales[precision];
    return Math.round(x * scale) / scale;
  };

  return ExtMath;

})(Math);

sparkline = {
  width: 96,
  height: 64
};

x = d3.scale.linear().range([0, sparkline.width - 2]);

y = d3.scale.linear().range([sparkline.height - 4, 0]);

sparkline.line = d3.svg.line().interpolate("basis").x(function(d) {
  return x(d[0]);
}).y(function(d) {
  return y(d[1]);
});

sparkline.append = function(g, d) {
  if (d.calls.length > 0) {
    x.domain(d3.extent(d.dates));
    y.domain(d3.extent(d.calls));
    g.append('path').datum(d.points()).classed('sparkline', true).attr('d', this.line);
    return g.append('circle').classed('sparkcircle', true).attr('cx', function() {
      return x(_.last(d.dates));
    }).attr('cy', function() {
      return y(_.last(d.calls));
    }).attr('r', 1.5);
  }
};

parseDate = d3.time.format("%Y-%m-%d").parse;

DateUtil = function(JSdate, type) {
  if (JSdate) {
    switch (type) {
      case "M/D":
        return (JSdate.getMonth() + 1) + "/" + JSdate.getDate();
    }
  }
};

Summary = (function() {
  function Summary(obj) {
    if (obj) {
      this.name = obj.name, this.dates = obj.dates, this.calls = obj.calls;
    }
    if (this.name == null) {
      this.name = "";
    }
    if (this.dates == null) {
      this.dates = [];
    }
    if (this.calls == null) {
      this.calls = [];
    }
  }

  Summary.prototype.sum = function(days) {
    if (days == null) {
      days = this.calls;
    }
    if (this.calls.length > 0) {
      return _.reduce(days, function(memo, num) {
        return memo + num;
      });
    } else {
      return 0;
    }
  };

  Summary.prototype.max = function() {
    return _.reduce(this.calls, function(m, n) {
      if (n > m) {
        return n;
      } else {
        return m;
      }
    });
  };

  Summary.prototype.min = function() {
    return _.reduce(this.calls, function(m, n) {
      if (n < m) {
        return n;
      } else {
        return m;
      }
    });
  };

  Summary.prototype.avg = function(moving) {
    var pastdays;
    pastdays = _.last(this.calls, moving);
    return ExtMath.truncate(this.sum(pastdays) / pastdays.length, 1);
  };

  Summary.prototype.add = function(points) {
    var iter;
    iter = function(e, i, l) {
      var date, date_pos, _ref;
      date_pos = _.sortedIndex(this.dates, e[0]);
      date = (_ref = this.dates[date_pos]) != null ? _ref : 0;
      if (e[0].valueOf() !== date.valueOf()) {
        this.dates = _.first(this.dates, date_pos).concat([e[0]], _.rest(this.dates, date_pos));
        this.calls = _.first(this.calls, date_pos).concat([0], _.rest(this.calls, date_pos));
      }
      return this.calls[date_pos] += e[1];
    };
    return _.each(points, iter, this);
  };

  Summary.prototype.points = function() {
    return _.zip(this.dates, this.calls);
  };

  return Summary;

})();

build = function(data) {
  var display, media_li, total_calls;
  console.log(data);
  total_calls = new Summary;
  total_calls.name = "ALL";
  display = _.map(data.contents.data, function(v, i, l) {
    var this_state;
    v.dates = _.map(v.x, function(v, i, l) {
      return parseDate(v);
    });
    v.calls = _.map(v.y, function(v, i, l) {
      var _name;
      return v - (l[_name = i - 1] != null ? l[_name] : l[_name] = 0);
    });
    this_state = new Summary(v);
    total_calls.add(this_state.points());
    return this_state;
  });
  display.unshift(total_calls);
  media_li = d3.select('#programs').selectAll('li').data(display).enter().append("li").classed("list-group-item", true).append("div").classed("media", true);
  return media_li.each(function(d, i) {
    var body, media, svg;
    media = d3.select(this);
    svg = media.append("div").classed("pull-left", true).append('svg').classed("media-object", true).attr('width', sparkline.width).attr('height', sparkline.height).append('g').attr('transform', 'translate(0, 2)');
    sparkline.append(svg, d);
    body = media.append('div').classed("media-body", true);
    body.append('h4').classed("media-heading", true).text(function(d, i) {
      return d.name;
    });
    body.append('p').text(function(d, i) {
      var sentence;
      sentence = ["There were", "", "balance checks between", "", "and", ""];
      sentence[1] = d.sum();
      sentence[3] = DateUtil(_.first(d.dates), "M/D");
      sentence[5] = DateUtil(_.last(d.dates), "M/D") + ".";
      return sentence.join(" ");
    });
    body.append('p').text(function(d, i) {
      var chk, tenday;
      tenday = d.avg(10);
      chk = tenday === 1 ? " check" : " checks";
      return "There is an average of  " + tenday + chk + " per day over the past 10 days.";
    });
    return body.append('p').text(function(d, i) {
      var diff, lastcalls, lastdates, sentence;
      lastcalls = _.last(d.calls, 2);
      lastdates = _.last(d.dates, 2);
      diff = lastcalls[1] - lastcalls[0];
      sentence = ["There ...", "num", "more", "checks", "on", "date", "than on", "date"];
      sentence[0] = (Math.abs(diff)) === 1 ? "There was" : "There were";
      sentence[1] = Math.abs(diff);
      sentence[2] = diff > 0 ? "more" : "fewer";
      sentence[3] = (Math.abs(diff)) === 1 ? "check" : "checks";
      sentence[5] = DateUtil(lastdates[1], "M/D");
      sentence[7] = DateUtil(lastdates[0], "M/D") + ".";
      if (diff === 0) {
        sentence[1] = "the";
        sentence[2] = "same number of";
        sentence[6] = "and";
      }
      return sentence.join(" ");
    });
  });
};

$(document).ready(function() {
  var data_url;
  data_url = 'http://whateverorigin.org/get?url=' + encodeURIComponent('https://plot.ly/~lippytak/184/balance-metrics-checks.json') + '&callback=?';
  return $.getJSON(data_url, build);
});

//# sourceMappingURL=data:application/json;base64,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QUMsSUFBVCxDQUFjLEdBQWQsRUFma0I7SUFBQSxDQUF0QixFQXBDSTtFQUFBLENBRFIsRUF2Qkk7QUFBQSxDQXhFUixDQUFBOztBQUFBLENBcUpBLENBQUUsUUFBRixDQUFXLENBQUMsS0FBWixDQUFrQixTQUFBLEdBQUE7QUFDaEIsTUFBQSxRQUFBO0FBQUEsRUFBQSxRQUFBLEdBQVUsb0NBQUEsR0FBdUMsa0JBQUEsQ0FBbUIsMkRBQW5CLENBQXZDLEdBQXlILGFBQW5JLENBQUE7U0FDQSxDQUFDLENBQUMsT0FBRixDQUFVLFFBQVYsRUFBb0IsS0FBcEIsRUFGZ0I7QUFBQSxDQUFsQixDQXJKQSxDQUFBIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZVJvb3QiOiIvc291cmNlLyIsInNvdXJjZXNDb250ZW50IjpbIiMgY29waWVkIGZyb20gaHR0cDovL3d3dy5jYWxpY293ZWJkZXYuY29tLzIwMTEvMDUvMDEvc2ltcGxlLWNvZmZlZXNjcmlwdC1pbnRyb2R1Y3Rpb24vXG5jbGFzcyBFeHRNYXRoIGV4dGVuZHMgTWF0aFxuICBAdHJ1bmNhdGUgPSAoeCwgcHJlY2lzaW9uID0gMCkgLT5cbiAgICBzY2FsZXMgPSBbMSwgMTAsIDEwMCwgMTAwMCwgMTAwMDAsIDEwMDAwMCwgMTAwMDAwMCwgMTAwMDAwMDAsIDEwMDAwMDAwMF1cbiAgICBzY2FsZSA9IHNjYWxlc1twcmVjaXNpb25dXG4gICAgTWF0aC5yb3VuZCh4ICogc2NhbGUpIC8gc2NhbGVcblxuIyBzcGFya2xpbmUgYWRhcHRlZCBmcm9tIGh0dHA6Ly93d3cudG5vZGEuY29tL2Jsb2cvMjAxMy0xMi0xOVxuc3BhcmtsaW5lID1cbiAgd2lkdGggOiA5NlxuICBoZWlnaHQgOiA2NFxuXG54ID0gZDMuc2NhbGUubGluZWFyKCkucmFuZ2UoWzAsIHNwYXJrbGluZS53aWR0aCAtIDJdKVxueSA9IGQzLnNjYWxlLmxpbmVhcigpLnJhbmdlKFtzcGFya2xpbmUuaGVpZ2h0IC0gNCwgMF0pXG5cbnNwYXJrbGluZS5saW5lID0gZDMuc3ZnLmxpbmUoKVxuICAuaW50ZXJwb2xhdGUoXCJiYXNpc1wiKVxuICAueCggKGQpIC0+IHgoIGRbMF0gKSApXG4gIC55KCAoZCkgLT4geSggZFsxXSApIClcblxuc3BhcmtsaW5lLmFwcGVuZCA9IChnLCBkKSAtPlxuICBpZiBkLmNhbGxzLmxlbmd0aCA+IDBcbiAgICB4LmRvbWFpbiBkMy5leHRlbnQgZC5kYXRlcyBcbiAgICB5LmRvbWFpbiBkMy5leHRlbnQgZC5jYWxscyAgXG4gICAgZy5hcHBlbmQoJ3BhdGgnKVxuICAgICAgLmRhdHVtKGQucG9pbnRzKCkpXG4gICAgICAuY2xhc3NlZCgnc3BhcmtsaW5lJyx0cnVlKVxuICAgICAgLmF0dHIoJ2QnLCBAbGluZSlcblxuICAgIGcuYXBwZW5kKCdjaXJjbGUnKVxuICAgICAgLmNsYXNzZWQoJ3NwYXJrY2lyY2xlJyx0cnVlKVxuICAgICAgLmF0dHIoJ2N4JywgLT4geCBfLmxhc3QgZC5kYXRlcylcbiAgICAgIC5hdHRyKCdjeScsIC0+IHkgXy5sYXN0IGQuY2FsbHMpXG4gICAgICAuYXR0cigncicsIDEuNSlcblxucGFyc2VEYXRlID0gZDMudGltZS5mb3JtYXQoXCIlWS0lbS0lZFwiKS5wYXJzZVxuXG5EYXRlVXRpbCA9IChKU2RhdGUsdHlwZSktPlxuICBpZiBKU2RhdGVcbiAgICBzd2l0Y2ggdHlwZVxuICAgICAgd2hlbiBcIk0vRFwiIHRoZW4gKEpTZGF0ZS5nZXRNb250aCgpICsgMSkgKyBcIi9cIiArIEpTZGF0ZS5nZXREYXRlKClcblxuY2xhc3MgU3VtbWFyeVxuICBjb25zdHJ1Y3Rvcjoob2JqKS0+XG4gICAgaWYgb2JqXG4gICAgICB7QG5hbWUsQGRhdGVzLEBjYWxsc30gPSBvYmpcbiAgICBAbmFtZSA/PSBcIlwiXG4gICAgQGRhdGVzID89IFtdXG4gICAgQGNhbGxzID89IFtdXG4gICAgXG4gIHN1bSA6IChkYXlzKS0+XG4gICAgZGF5cyA/PSBAY2FsbHNcbiAgICBpZiBAY2FsbHMubGVuZ3RoID4gMFxuICAgICAgXy5yZWR1Y2UgZGF5cywobWVtbywgbnVtKSAtPiBtZW1vICsgbnVtXG4gICAgZWxzZVxuICAgICAgMFxuICBtYXggOiAtPiBfLnJlZHVjZSBAY2FsbHMsKG0sbiktPiBpZiBuPm0gdGhlbiBuIGVsc2UgbVxuICBtaW4gOiAtPiBfLnJlZHVjZSBAY2FsbHMsKG0sbiktPiBpZiBuPG0gdGhlbiBuIGVsc2UgbVxuICBhdmcgOiAobW92aW5nKS0+XG4gICAgcGFzdGRheXMgPSBfLmxhc3QoQGNhbGxzLG1vdmluZylcbiAgICBFeHRNYXRoLnRydW5jYXRlIEBzdW0ocGFzdGRheXMpIC8gcGFzdGRheXMubGVuZ3RoLDFcbiAgYWRkOiAocG9pbnRzKS0+XG4gICAgaXRlciA9IChlLGksbCktPlxuICAgICAgZGF0ZV9wb3MgPSBfLnNvcnRlZEluZGV4KEBkYXRlcyxlWzBdKVxuICAgICAgZGF0ZSA9IEBkYXRlc1tkYXRlX3Bvc10gPyAwXG4gICAgICBpZiBlWzBdLnZhbHVlT2YoKSBpc250IGRhdGUudmFsdWVPZigpXG4gICAgICAgIEBkYXRlcz0gXy5maXJzdChAZGF0ZXMsZGF0ZV9wb3MpLmNvbmNhdCAgW2VbMF1dICwgXy5yZXN0KEBkYXRlcyxkYXRlX3BvcylcbiAgICAgICAgQGNhbGxzPSBfLmZpcnN0KEBjYWxscyxkYXRlX3BvcykuY29uY2F0ICBbMF0gLCBfLnJlc3QoQGNhbGxzLGRhdGVfcG9zKVxuICAgICAgQGNhbGxzW2RhdGVfcG9zXSAgKz0gZVsxXVxuICAgIF8uZWFjaCBwb2ludHMsaXRlcixAXG4gIHBvaW50czogLT5cbiAgICBfLnppcCBAZGF0ZXMsQGNhbGxzXG5cbmJ1aWxkID0gKGRhdGEpLT5cbiAgICBjb25zb2xlLmxvZyhkYXRhKVxuICAgIHRvdGFsX2NhbGxzPSBuZXcgU3VtbWFyeSAgICAgXG4gICAgdG90YWxfY2FsbHMubmFtZSA9XCJBTExcIlxuICAgIGRpc3BsYXkgPSBfLm1hcChkYXRhLmNvbnRlbnRzLmRhdGEsXG4gICAgICAodixpLGwpLT5cbiAgICAgICAgdi5kYXRlcyA9IF8ubWFwKHYueCwgKHYsaSxsKSAtPiBwYXJzZURhdGUgdiApIFxuICAgICAgICB2LmNhbGxzID0gXy5tYXAodi55LCAodixpLGwpIC0+IHYtbFtpLTFdPz0wICkgIFxuICAgICAgICB0aGlzX3N0YXRlID0gbmV3IFN1bW1hcnkodilcbiAgICAgICAgdG90YWxfY2FsbHMuYWRkIHRoaXNfc3RhdGUucG9pbnRzKClcbiAgICAgICAgdGhpc19zdGF0ZVxuICAgIClcbiAgICBkaXNwbGF5LnVuc2hpZnQgdG90YWxfY2FsbHNcbiAgICBcbiAgICBtZWRpYV9saSA9IGQzLnNlbGVjdCgnI3Byb2dyYW1zJylcbiAgICAgIC5zZWxlY3RBbGwoJ2xpJylcbiAgICAgIC5kYXRhKGRpc3BsYXkpXG4gICAgICAuZW50ZXIoKVxuICAgICAgLmFwcGVuZChcImxpXCIpXG4gICAgICAgIC5jbGFzc2VkKFwibGlzdC1ncm91cC1pdGVtXCIsdHJ1ZSlcbiAgICAgIC5hcHBlbmQoXCJkaXZcIilcbiAgICAgICAgLmNsYXNzZWQoXCJtZWRpYVwiLHRydWUpXG5cbiAgICBtZWRpYV9saSBcbiAgICAgIC5lYWNoIChkLGkpLT5cblxuICAgICAgICBtZWRpYSA9IGQzLnNlbGVjdCBAXG5cbiAgICAgICAgc3ZnID0gbWVkaWEuYXBwZW5kKFwiZGl2XCIpXG4gICAgICAgICAgLmNsYXNzZWQoXCJwdWxsLWxlZnRcIix0cnVlKVxuICAgICAgICAgIC5hcHBlbmQoJ3N2ZycpXG4gICAgICAgICAgICAuY2xhc3NlZChcIm1lZGlhLW9iamVjdFwiLHRydWUpXG4gICAgICAgICAgICAuYXR0cignd2lkdGgnLCBzcGFya2xpbmUud2lkdGgpXG4gICAgICAgICAgICAuYXR0cignaGVpZ2h0Jywgc3BhcmtsaW5lLmhlaWdodClcbiAgICAgICAgICAgIC5hcHBlbmQoJ2cnKVxuICAgICAgICAgICAgICAuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgwLCAyKScpO1xuXG4gICAgICAgIHNwYXJrbGluZS5hcHBlbmQgc3ZnLCBkXG4gICAgICAgIFxuICAgICAgICBib2R5ID0gbWVkaWEgLmFwcGVuZCgnZGl2JylcbiAgICAgICAgICAuY2xhc3NlZChcIm1lZGlhLWJvZHlcIix0cnVlKVxuXG4gICAgICAgIGJvZHkuYXBwZW5kKCdoNCcpXG4gICAgICAgICAgLmNsYXNzZWQoXCJtZWRpYS1oZWFkaW5nXCIsdHJ1ZSlcbiAgICAgICAgICAudGV4dCAoZCxpKS0+ZC5uYW1lXG5cbiAgICAgICAgYm9keS5hcHBlbmQoJ3AnKVxuICAgICAgICAgIC50ZXh0IChkLGkpLT4gXG4gICAgICAgICAgICBzZW50ZW5jZSA9IFtcIlRoZXJlIHdlcmVcIixcIlwiLFwiYmFsYW5jZSBjaGVja3MgYmV0d2VlblwiLFwiXCIsXCJhbmRcIixcIlwiXVxuICAgICAgICAgICAgc2VudGVuY2VbMV09ZC5zdW0oKVxuICAgICAgICAgICAgc2VudGVuY2VbM109RGF0ZVV0aWwoXy5maXJzdChkLmRhdGVzKSxcIk0vRFwiKVxuICAgICAgICAgICAgc2VudGVuY2VbNV09RGF0ZVV0aWwoXy5sYXN0KGQuZGF0ZXMpLFwiTS9EXCIpK1wiLlwiXG4gICAgICAgICAgICBzZW50ZW5jZS5qb2luIFwiIFwiXG4gICAgICAgICAgICBcbiAgICAgICAgYm9keS5hcHBlbmQoJ3AnKVxuICAgICAgICAgIC50ZXh0IChkLGkpLT5cbiAgICAgICAgICAgIHRlbmRheSA9IGQuYXZnKDEwKVxuICAgICAgICAgICAgY2hrID0gaWYgdGVuZGF5IGlzIDEgdGhlbiBcIiBjaGVja1wiIGVsc2UgXCIgY2hlY2tzXCJcbiAgICAgICAgICAgIFwiVGhlcmUgaXMgYW4gYXZlcmFnZSBvZiAgXCIgKyB0ZW5kYXkgKyBjaGsgKyBcIiBwZXIgZGF5IG92ZXIgdGhlIHBhc3QgMTAgZGF5cy5cIlxuXG4gICAgICAgIGJvZHkuYXBwZW5kKCdwJykudGV4dCAoZCxpKS0+XG4gICAgICAgICAgICBsYXN0Y2FsbHMgPSBfLmxhc3QoZC5jYWxscywyKVxuICAgICAgICAgICAgbGFzdGRhdGVzID0gXy5sYXN0KGQuZGF0ZXMsMilcbiAgICAgICAgICAgIGRpZmY9IGxhc3RjYWxsc1sxXSAtIGxhc3RjYWxsc1swXVxuICAgICAgICAgICAgc2VudGVuY2UgPSBbXCJUaGVyZSAuLi5cIixcIm51bVwiLFwibW9yZVwiLFwiY2hlY2tzXCIsXCJvblwiLFwiZGF0ZVwiLFwidGhhbiBvblwiLFwiZGF0ZVwiXVxuICAgICAgICAgICAgc2VudGVuY2VbMF0gPSBpZiAoTWF0aC5hYnMgZGlmZikgaXMgMSB0aGVuIFwiVGhlcmUgd2FzXCIgZWxzZSBcIlRoZXJlIHdlcmVcIlxuICAgICAgICAgICAgc2VudGVuY2VbMV0gPSBNYXRoLmFicyBkaWZmXG4gICAgICAgICAgICBzZW50ZW5jZVsyXSA9IGlmIGRpZmYgPiAwIHRoZW4gXCJtb3JlXCIgZWxzZSBcImZld2VyXCJcbiAgICAgICAgICAgIHNlbnRlbmNlWzNdID0gaWYgKE1hdGguYWJzIGRpZmYpIGlzIDEgdGhlbiBcImNoZWNrXCIgZWxzZSBcImNoZWNrc1wiXG4gICAgICAgICAgICBzZW50ZW5jZVs1XSA9IERhdGVVdGlsIGxhc3RkYXRlc1sxXSxcIk0vRFwiXG4gICAgICAgICAgICBzZW50ZW5jZVs3XSA9IERhdGVVdGlsKCBsYXN0ZGF0ZXNbMF0sXCJNL0RcIiApKyBcIi5cIlxuICAgICAgICAgICAgaWYgZGlmZiBpcyAwXG4gICAgICAgICAgICAgIHNlbnRlbmNlWzFdPVwidGhlXCJcbiAgICAgICAgICAgICAgc2VudGVuY2VbMl09XCJzYW1lIG51bWJlciBvZlwiXG4gICAgICAgICAgICAgIHNlbnRlbmNlWzZdPVwiYW5kXCJcbiAgICAgICAgICAgIHNlbnRlbmNlLmpvaW4gXCIgXCJcbiAgICAgICAgICAgIFxuJChkb2N1bWVudCkucmVhZHkgLT5cbiAgZGF0YV91cmwgPSdodHRwOi8vd2hhdGV2ZXJvcmlnaW4ub3JnL2dldD91cmw9JyArIGVuY29kZVVSSUNvbXBvbmVudCgnaHR0cHM6Ly9wbG90Lmx5L35saXBweXRhay8xODQvYmFsYW5jZS1tZXRyaWNzLWNoZWNrcy5qc29uJykgKyAnJmNhbGxiYWNrPT8nIFxuICAkLmdldEpTT04gZGF0YV91cmwgLGJ1aWxkXG5cbiJdfQ==