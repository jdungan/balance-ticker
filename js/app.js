var DateUtil, ExtMath, Summary, build, height, line, parseDate, sparkline, width, x, y,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

ExtMath = (function(_super) {
  __extends(ExtMath, _super);

  function ExtMath() {
    return ExtMath.__super__.constructor.apply(this, arguments);
  }

  ExtMath.truncate = function(x, precision) {
    var scale, scales;
    if (precision == null) {
      precision = 0;
    }
    scales = [1, 10, 100, 1000, 10000, 100000, 1000000, 10000000, 100000000];
    scale = scales[precision];
    return Math.round(x * scale) / scale;
  };

  return ExtMath;

})(Math);

width = 96;

height = 64;

x = d3.scale.linear().range([0, width - 2]);

y = d3.scale.linear().range([height - 4, 0]);

parseDate = d3.time.format("%Y-%m-%d").parse;

line = d3.svg.line().interpolate("basis").x(function(d) {
  return x(d[0]);
}).y(function(d) {
  return y(d[1]);
});

sparkline = function(g, data) {
  if (data.length > 0) {
    g.append('path').datum(data).classed('sparkline', true).attr('d', line);
    return g.append('circle').classed('sparkcircle', true).attr('cx', function() {
      return x(_.last(data)[0]);
    }).attr('cy', function() {
      return y(_.last(data)[1]);
    }).attr('r', 1.5);
  }
};

DateUtil = function(JSdate, type) {
  if (JSdate) {
    switch (type) {
      case "M/D":
        return (JSdate.getMonth() + 1) + "/" + JSdate.getDate();
    }
  }
};

Summary = (function() {
  function Summary() {
    this.name = "";
    this.calls = [];
    this.dates = [];
  }

  Summary.prototype.sum = function(days) {
    if (days == null) {
      days = this.calls;
    }
    if (this.calls.length > 0) {
      return _.reduce(days, function(memo, num) {
        return memo + num;
      });
    } else {
      return 0;
    }
  };

  Summary.prototype.max = function() {
    return _.reduce(this.calls, function(m, n) {
      if (n > m) {
        return n;
      } else {
        return m;
      }
    });
  };

  Summary.prototype.min = function() {
    return _.reduce(this.calls, function(m, n) {
      if (n < m) {
        return n;
      } else {
        return m;
      }
    });
  };

  Summary.prototype.avg = function(moving) {
    var pastdays;
    pastdays = _.last(this.calls, moving);
    return ExtMath.truncate(this.sum(pastdays) / pastdays.length, 1);
  };

  Summary.prototype.add = function(points) {
    var iter;
    iter = function(e, i, l) {
      var date, date_pos, _ref;
      date_pos = _.sortedIndex(this.dates, e[0]);
      date = (_ref = this.dates[date_pos]) != null ? _ref : 0;
      if (e[0].valueOf() !== date.valueOf()) {
        this.dates = _.first(this.dates, date_pos).concat([e[0]], _.rest(this.dates, date_pos));
        this.calls = _.first(this.calls, date_pos).concat([0], _.rest(this.calls, date_pos));
      }
      return this.calls[date_pos] += e[1];
    };
    return _.each(points, iter, this);
  };

  Summary.prototype.points = function() {
    return _.zip(this.dates, this.calls);
  };

  return Summary;

})();

build = function(data) {
  var display, media_li, total_calls;
  console.log(data);
  total_calls = new Summary;
  total_calls.name = "ALL";
  display = _.map(data.contents.data, function(v, i, l) {
    var calls, dates, this_state;
    dates = _.map(v.x, function(v, i, l) {
      return parseDate(v);
    });
    calls = _.map(v.y, function(v, i, l) {
      var _name;
      return v - (l[_name = i - 1] != null ? l[_name] : l[_name] = 0);
    });
    this_state = new Summary;
    this_state.name = v.name;
    this_state.add(_.zip(dates, calls));
    total_calls.add(this_state.points());
    return this_state;
  });
  display.unshift(total_calls);
  media_li = d3.select('#programs').selectAll('li').data(display).enter().append("li").classed("list-group-item", true).append("div").classed("media", true);
  return media_li.each(function(d, i) {
    var body, media, svg;
    x.domain(d3.extent(d.dates));
    y.domain(d3.extent(d.calls));
    media = d3.select(this);
    svg = media.append("div").classed("pull-left", true).append('svg').classed("media-object", true).attr('width', width).attr('height', height).append('g').attr('transform', 'translate(0, 2)');
    sparkline(svg, d.points());
    body = media.append('div').classed("media-body", true);
    body.append('h4').classed("media-heading", true).text(function(d, i) {
      return d.name;
    });
    body.append('p').text(function(d, i) {
      var lastdate;
      lastdate = _.last(d.dates);
      return "There have been " + d.sum() + " balance checks since " + DateUtil(lastdate, "M/D") + ".";
    });
    body.append('p').text(function(d, i) {
      var chk, tenday;
      tenday = d.avg(10);
      chk = tenday === 1 ? " check" : " checks";
      return "There is an average of  " + tenday + chk + " per day over the past 10 days.";
    });
    return body.append('p').text(function(d, i) {
      var diff, lastcalls, lastdates, sentence;
      lastcalls = _.last(d.calls, 2);
      lastdates = _.last(d.dates, 2);
      diff = lastcalls[1] - lastcalls[0];
      sentence = ["", "", "", "on", "", "than on", ""];
      sentence[0] = (Math.abs(diff)) === 1 ? "There was" : "There were";
      sentence[1] = Math.abs(diff);
      sentence[2] = diff > 0 ? "more" : "fewer";
      sentence[4] = DateUtil(lastdates[1], "M/D");
      sentence[6] = DateUtil(lastdates[0], "M/D") + ".";
      return sentence.join(" ");
    });
  });
};

$(document).ready(function() {
  var data_url;
  data_url = 'http://whateverorigin.org/get?url=' + encodeURIComponent('https://plot.ly/~lippytak/184/balance-metrics-checks.json') + '&callback=?';
  return $.getJSON(data_url, build);
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsSUFBQSxrRkFBQTtFQUFBO2lTQUFBOztBQUFBO0FBQ0UsNEJBQUEsQ0FBQTs7OztHQUFBOztBQUFBLEVBQUEsT0FBQyxDQUFBLFFBQUQsR0FBWSxTQUFDLENBQUQsRUFBSSxTQUFKLEdBQUE7QUFDVixRQUFBLGFBQUE7O01BRGMsWUFBWTtLQUMxQjtBQUFBLElBQUEsTUFBQSxHQUFTLENBQUMsQ0FBRCxFQUFJLEVBQUosRUFBUSxHQUFSLEVBQWEsSUFBYixFQUFtQixLQUFuQixFQUEwQixNQUExQixFQUFrQyxPQUFsQyxFQUEyQyxRQUEzQyxFQUFxRCxTQUFyRCxDQUFULENBQUE7QUFBQSxJQUNBLEtBQUEsR0FBUSxNQUFPLENBQUEsU0FBQSxDQURmLENBQUE7V0FFQSxJQUFJLENBQUMsS0FBTCxDQUFXLENBQUEsR0FBSSxLQUFmLENBQUEsR0FBd0IsTUFIZDtFQUFBLENBQVosQ0FBQTs7aUJBQUE7O0dBRG9CLEtBQXRCLENBQUE7O0FBQUEsS0FPQSxHQUFRLEVBUFIsQ0FBQTs7QUFBQSxNQVFBLEdBQVMsRUFSVCxDQUFBOztBQUFBLENBU0EsR0FBSSxFQUFFLENBQUMsS0FBSyxDQUFDLE1BQVQsQ0FBQSxDQUFpQixDQUFDLEtBQWxCLENBQXdCLENBQUMsQ0FBRCxFQUFJLEtBQUEsR0FBUSxDQUFaLENBQXhCLENBVEosQ0FBQTs7QUFBQSxDQVVBLEdBQUksRUFBRSxDQUFDLEtBQUssQ0FBQyxNQUFULENBQUEsQ0FBaUIsQ0FBQyxLQUFsQixDQUF3QixDQUFDLE1BQUEsR0FBUyxDQUFWLEVBQWEsQ0FBYixDQUF4QixDQVZKLENBQUE7O0FBQUEsU0FXQSxHQUFZLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBUixDQUFlLFVBQWYsQ0FBMEIsQ0FBQyxLQVh2QyxDQUFBOztBQUFBLElBYUEsR0FBTyxFQUFFLENBQUMsR0FBRyxDQUFDLElBQVAsQ0FBQSxDQUNMLENBQUMsV0FESSxDQUNRLE9BRFIsQ0FFTCxDQUFDLENBRkksQ0FFRCxTQUFDLENBQUQsR0FBQTtTQUFPLENBQUEsQ0FBRyxDQUFFLENBQUEsQ0FBQSxDQUFMLEVBQVA7QUFBQSxDQUZDLENBR0wsQ0FBQyxDQUhJLENBR0QsU0FBQyxDQUFELEdBQUE7U0FBTyxDQUFBLENBQUcsQ0FBRSxDQUFBLENBQUEsQ0FBTCxFQUFQO0FBQUEsQ0FIQyxDQWJQLENBQUE7O0FBQUEsU0FrQkEsR0FBWSxTQUFDLENBQUQsRUFBSSxJQUFKLEdBQUE7QUFFVixFQUFBLElBQUcsSUFBSSxDQUFDLE1BQUwsR0FBYyxDQUFqQjtBQUNFLElBQUEsQ0FBQyxDQUFDLE1BQUYsQ0FBUyxNQUFULENBQ0UsQ0FBQyxLQURILENBQ1MsSUFEVCxDQUVFLENBQUMsT0FGSCxDQUVXLFdBRlgsRUFFdUIsSUFGdkIsQ0FHRSxDQUFDLElBSEgsQ0FHUSxHQUhSLEVBR2EsSUFIYixDQUFBLENBQUE7V0FLQSxDQUFDLENBQUMsTUFBRixDQUFTLFFBQVQsQ0FDRSxDQUFDLE9BREgsQ0FDVyxhQURYLEVBQ3lCLElBRHpCLENBRUUsQ0FBQyxJQUZILENBRVEsSUFGUixFQUVjLFNBQUEsR0FBQTthQUFHLENBQUEsQ0FBRyxDQUFDLENBQUMsSUFBRixDQUFPLElBQVAsQ0FBYSxDQUFBLENBQUEsQ0FBaEIsRUFBSDtJQUFBLENBRmQsQ0FHRSxDQUFDLElBSEgsQ0FHUSxJQUhSLEVBR2MsU0FBQSxHQUFBO2FBQUcsQ0FBQSxDQUFHLENBQUMsQ0FBQyxJQUFGLENBQU8sSUFBUCxDQUFhLENBQUEsQ0FBQSxDQUFoQixFQUFIO0lBQUEsQ0FIZCxDQUlFLENBQUMsSUFKSCxDQUlRLEdBSlIsRUFJYSxHQUpiLEVBTkY7R0FGVTtBQUFBLENBbEJaLENBQUE7O0FBQUEsUUFnQ0EsR0FBVyxTQUFDLE1BQUQsRUFBUSxJQUFSLEdBQUE7QUFDVCxFQUFBLElBQUcsTUFBSDtBQUNFLFlBQU8sSUFBUDtBQUFBLFdBQ08sS0FEUDtlQUNrQixDQUFDLE1BQU0sQ0FBQyxRQUFQLENBQUEsQ0FBQSxHQUFvQixDQUFyQixDQUFBLEdBQTBCLEdBQTFCLEdBQWdDLE1BQU0sQ0FBQyxPQUFQLENBQUEsRUFEbEQ7QUFBQSxLQURGO0dBRFM7QUFBQSxDQWhDWCxDQUFBOztBQUFBO0FBc0NjLEVBQUEsaUJBQUEsR0FBQTtBQUNWLElBQUEsSUFBQyxDQUFBLElBQUQsR0FBTyxFQUFQLENBQUE7QUFBQSxJQUNBLElBQUMsQ0FBQSxLQUFELEdBQU8sRUFEUCxDQUFBO0FBQUEsSUFFQSxJQUFDLENBQUEsS0FBRCxHQUFPLEVBRlAsQ0FEVTtFQUFBLENBQVo7O0FBQUEsb0JBSUEsR0FBQSxHQUFNLFNBQUMsSUFBRCxHQUFBOztNQUNKLE9BQVEsSUFBQyxDQUFBO0tBQVQ7QUFDQSxJQUFBLElBQUcsSUFBQyxDQUFBLEtBQUssQ0FBQyxNQUFQLEdBQWdCLENBQW5CO2FBQ0UsQ0FBQyxDQUFDLE1BQUYsQ0FBUyxJQUFULEVBQWMsU0FBQyxJQUFELEVBQU8sR0FBUCxHQUFBO2VBQWUsSUFBQSxHQUFPLElBQXRCO01BQUEsQ0FBZCxFQURGO0tBQUEsTUFBQTthQUdFLEVBSEY7S0FGSTtFQUFBLENBSk4sQ0FBQTs7QUFBQSxvQkFVQSxHQUFBLEdBQU0sU0FBQSxHQUFBO1dBQUcsQ0FBQyxDQUFDLE1BQUYsQ0FBUyxJQUFDLENBQUEsS0FBVixFQUFnQixTQUFDLENBQUQsRUFBRyxDQUFILEdBQUE7QUFBUSxNQUFBLElBQUcsQ0FBQSxHQUFFLENBQUw7ZUFBWSxFQUFaO09BQUEsTUFBQTtlQUFtQixFQUFuQjtPQUFSO0lBQUEsQ0FBaEIsRUFBSDtFQUFBLENBVk4sQ0FBQTs7QUFBQSxvQkFXQSxHQUFBLEdBQU0sU0FBQSxHQUFBO1dBQUcsQ0FBQyxDQUFDLE1BQUYsQ0FBUyxJQUFDLENBQUEsS0FBVixFQUFnQixTQUFDLENBQUQsRUFBRyxDQUFILEdBQUE7QUFBUSxNQUFBLElBQUcsQ0FBQSxHQUFFLENBQUw7ZUFBWSxFQUFaO09BQUEsTUFBQTtlQUFtQixFQUFuQjtPQUFSO0lBQUEsQ0FBaEIsRUFBSDtFQUFBLENBWE4sQ0FBQTs7QUFBQSxvQkFZQSxHQUFBLEdBQU0sU0FBQyxNQUFELEdBQUE7QUFDSixRQUFBLFFBQUE7QUFBQSxJQUFBLFFBQUEsR0FBVyxDQUFDLENBQUMsSUFBRixDQUFPLElBQUMsQ0FBQSxLQUFSLEVBQWMsTUFBZCxDQUFYLENBQUE7V0FDQSxPQUFPLENBQUMsUUFBUixDQUFpQixJQUFDLENBQUEsR0FBRCxDQUFLLFFBQUwsQ0FBQSxHQUFpQixRQUFRLENBQUMsTUFBM0MsRUFBa0QsQ0FBbEQsRUFGSTtFQUFBLENBWk4sQ0FBQTs7QUFBQSxvQkFlQSxHQUFBLEdBQUssU0FBQyxNQUFELEdBQUE7QUFDSCxRQUFBLElBQUE7QUFBQSxJQUFBLElBQUEsR0FBTyxTQUFDLENBQUQsRUFBRyxDQUFILEVBQUssQ0FBTCxHQUFBO0FBQ0wsVUFBQSxvQkFBQTtBQUFBLE1BQUEsUUFBQSxHQUFXLENBQUMsQ0FBQyxXQUFGLENBQWMsSUFBQyxDQUFBLEtBQWYsRUFBcUIsQ0FBRSxDQUFBLENBQUEsQ0FBdkIsQ0FBWCxDQUFBO0FBQUEsTUFDQSxJQUFBLGtEQUEwQixDQUQxQixDQUFBO0FBRUEsTUFBQSxJQUFHLENBQUUsQ0FBQSxDQUFBLENBQUUsQ0FBQyxPQUFMLENBQUEsQ0FBQSxLQUFvQixJQUFJLENBQUMsT0FBTCxDQUFBLENBQXZCO0FBQ0UsUUFBQSxJQUFDLENBQUEsS0FBRCxHQUFRLENBQUMsQ0FBQyxLQUFGLENBQVEsSUFBQyxDQUFBLEtBQVQsRUFBZSxRQUFmLENBQXdCLENBQUMsTUFBekIsQ0FBaUMsQ0FBQyxDQUFFLENBQUEsQ0FBQSxDQUFILENBQWpDLEVBQTBDLENBQUMsQ0FBQyxJQUFGLENBQU8sSUFBQyxDQUFBLEtBQVIsRUFBYyxRQUFkLENBQTFDLENBQVIsQ0FBQTtBQUFBLFFBQ0EsSUFBQyxDQUFBLEtBQUQsR0FBUSxDQUFDLENBQUMsS0FBRixDQUFRLElBQUMsQ0FBQSxLQUFULEVBQWUsUUFBZixDQUF3QixDQUFDLE1BQXpCLENBQWlDLENBQUMsQ0FBRCxDQUFqQyxFQUF1QyxDQUFDLENBQUMsSUFBRixDQUFPLElBQUMsQ0FBQSxLQUFSLEVBQWMsUUFBZCxDQUF2QyxDQURSLENBREY7T0FGQTthQUtBLElBQUMsQ0FBQSxLQUFNLENBQUEsUUFBQSxDQUFQLElBQXFCLENBQUUsQ0FBQSxDQUFBLEVBTmxCO0lBQUEsQ0FBUCxDQUFBO1dBT0EsQ0FBQyxDQUFDLElBQUYsQ0FBTyxNQUFQLEVBQWMsSUFBZCxFQUFtQixJQUFuQixFQVJHO0VBQUEsQ0FmTCxDQUFBOztBQUFBLG9CQXdCQSxNQUFBLEdBQVEsU0FBQSxHQUFBO1dBQ04sQ0FBQyxDQUFDLEdBQUYsQ0FBTSxJQUFDLENBQUEsS0FBUCxFQUFhLElBQUMsQ0FBQSxLQUFkLEVBRE07RUFBQSxDQXhCUixDQUFBOztpQkFBQTs7SUF0Q0YsQ0FBQTs7QUFBQSxLQW1FQSxHQUFRLFNBQUMsSUFBRCxHQUFBO0FBQ0osTUFBQSw4QkFBQTtBQUFBLEVBQUEsT0FBTyxDQUFDLEdBQVIsQ0FBWSxJQUFaLENBQUEsQ0FBQTtBQUFBLEVBQ0EsV0FBQSxHQUFhLEdBQUEsQ0FBQSxPQURiLENBQUE7QUFBQSxFQUVBLFdBQVcsQ0FBQyxJQUFaLEdBQWtCLEtBRmxCLENBQUE7QUFBQSxFQUlBLE9BQUEsR0FBVSxDQUFDLENBQUMsR0FBRixDQUFNLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBcEIsRUFDUixTQUFDLENBQUQsRUFBRyxDQUFILEVBQUssQ0FBTCxHQUFBO0FBQ0UsUUFBQSx3QkFBQTtBQUFBLElBQUEsS0FBQSxHQUFRLENBQUMsQ0FBQyxHQUFGLENBQU0sQ0FBQyxDQUFDLENBQVIsRUFBVyxTQUFDLENBQUQsRUFBRyxDQUFILEVBQUssQ0FBTCxHQUFBO2FBQVcsU0FBQSxDQUFVLENBQVYsRUFBWDtJQUFBLENBQVgsQ0FBUixDQUFBO0FBQUEsSUFDQSxLQUFBLEdBQVEsQ0FBQyxDQUFDLEdBQUYsQ0FBTSxDQUFDLENBQUMsQ0FBUixFQUFXLFNBQUMsQ0FBRCxFQUFHLENBQUgsRUFBSyxDQUFMLEdBQUE7QUFBVyxVQUFBLEtBQUE7YUFBQSxDQUFBLCtCQUFFLFdBQUEsV0FBUSxHQUFyQjtJQUFBLENBQVgsQ0FEUixDQUFBO0FBQUEsSUFFQSxVQUFBLEdBQWEsR0FBQSxDQUFBLE9BRmIsQ0FBQTtBQUFBLElBR0EsVUFBVSxDQUFDLElBQVgsR0FBa0IsQ0FBQyxDQUFDLElBSHBCLENBQUE7QUFBQSxJQUlBLFVBQVUsQ0FBQyxHQUFYLENBQWUsQ0FBQyxDQUFDLEdBQUYsQ0FBTSxLQUFOLEVBQVksS0FBWixDQUFmLENBSkEsQ0FBQTtBQUFBLElBS0EsV0FBVyxDQUFDLEdBQVosQ0FBZ0IsVUFBVSxDQUFDLE1BQVgsQ0FBQSxDQUFoQixDQUxBLENBQUE7V0FNQSxXQVBGO0VBQUEsQ0FEUSxDQUpWLENBQUE7QUFBQSxFQWVBLE9BQU8sQ0FBQyxPQUFSLENBQWdCLFdBQWhCLENBZkEsQ0FBQTtBQUFBLEVBaUJBLFFBQUEsR0FBVyxFQUFFLENBQUMsTUFBSCxDQUFVLFdBQVYsQ0FDVCxDQUFDLFNBRFEsQ0FDRSxJQURGLENBRVQsQ0FBQyxJQUZRLENBRUgsT0FGRyxDQUdULENBQUMsS0FIUSxDQUFBLENBSVQsQ0FBQyxNQUpRLENBSUQsSUFKQyxDQUtQLENBQUMsT0FMTSxDQUtFLGlCQUxGLEVBS29CLElBTHBCLENBTVQsQ0FBQyxNQU5RLENBTUQsS0FOQyxDQU9QLENBQUMsT0FQTSxDQU9FLE9BUEYsRUFPVSxJQVBWLENBakJYLENBQUE7U0EwQkEsUUFDRSxDQUFDLElBREgsQ0FDUSxTQUFDLENBQUQsRUFBRyxDQUFILEdBQUE7QUFFSixRQUFBLGdCQUFBO0FBQUEsSUFBQSxDQUFDLENBQUMsTUFBRixDQUFTLEVBQUUsQ0FBQyxNQUFILENBQVUsQ0FBQyxDQUFDLEtBQVosQ0FBVCxDQUFBLENBQUE7QUFBQSxJQUNBLENBQUMsQ0FBQyxNQUFGLENBQVMsRUFBRSxDQUFDLE1BQUgsQ0FBVSxDQUFDLENBQUMsS0FBWixDQUFULENBREEsQ0FBQTtBQUFBLElBR0EsS0FBQSxHQUFRLEVBQUUsQ0FBQyxNQUFILENBQVUsSUFBVixDQUhSLENBQUE7QUFBQSxJQUtBLEdBQUEsR0FBTSxLQUFLLENBQUMsTUFBTixDQUFhLEtBQWIsQ0FDSixDQUFDLE9BREcsQ0FDSyxXQURMLEVBQ2lCLElBRGpCLENBRUosQ0FBQyxNQUZHLENBRUksS0FGSixDQUdGLENBQUMsT0FIQyxDQUdPLGNBSFAsRUFHc0IsSUFIdEIsQ0FJRixDQUFDLElBSkMsQ0FJSSxPQUpKLEVBSWEsS0FKYixDQUtGLENBQUMsSUFMQyxDQUtJLFFBTEosRUFLYyxNQUxkLENBTUYsQ0FBQyxNQU5DLENBTU0sR0FOTixDQU9BLENBQUMsSUFQRCxDQU9NLFdBUE4sRUFPbUIsaUJBUG5CLENBTE4sQ0FBQTtBQUFBLElBY0EsU0FBQSxDQUFVLEdBQVYsRUFBZSxDQUFDLENBQUMsTUFBRixDQUFBLENBQWYsQ0FkQSxDQUFBO0FBQUEsSUFnQkEsSUFBQSxHQUFPLEtBQU0sQ0FBQyxNQUFQLENBQWMsS0FBZCxDQUNMLENBQUMsT0FESSxDQUNJLFlBREosRUFDaUIsSUFEakIsQ0FoQlAsQ0FBQTtBQUFBLElBa0JBLElBQUksQ0FBQyxNQUFMLENBQVksSUFBWixDQUNFLENBQUMsT0FESCxDQUNXLGVBRFgsRUFDMkIsSUFEM0IsQ0FFRSxDQUFDLElBRkgsQ0FFUSxTQUFDLENBQUQsRUFBRyxDQUFILEdBQUE7YUFBTyxDQUFDLENBQUMsS0FBVDtJQUFBLENBRlIsQ0FsQkEsQ0FBQTtBQUFBLElBcUJBLElBQUksQ0FBQyxNQUFMLENBQVksR0FBWixDQUNFLENBQUMsSUFESCxDQUNRLFNBQUMsQ0FBRCxFQUFHLENBQUgsR0FBQTtBQUNKLFVBQUEsUUFBQTtBQUFBLE1BQUEsUUFBQSxHQUFTLENBQUMsQ0FBQyxJQUFGLENBQU8sQ0FBQyxDQUFDLEtBQVQsQ0FBVCxDQUFBO2FBQ0Esa0JBQUEsR0FBcUIsQ0FBQyxDQUFDLEdBQUYsQ0FBQSxDQUFyQixHQUErQix3QkFBL0IsR0FBMEQsUUFBQSxDQUFTLFFBQVQsRUFBa0IsS0FBbEIsQ0FBMUQsR0FBcUYsSUFGakY7SUFBQSxDQURSLENBckJBLENBQUE7QUFBQSxJQXlCQSxJQUFJLENBQUMsTUFBTCxDQUFZLEdBQVosQ0FDRSxDQUFDLElBREgsQ0FDUSxTQUFDLENBQUQsRUFBRyxDQUFILEdBQUE7QUFDSixVQUFBLFdBQUE7QUFBQSxNQUFBLE1BQUEsR0FBUyxDQUFDLENBQUMsR0FBRixDQUFNLEVBQU4sQ0FBVCxDQUFBO0FBQUEsTUFDQSxHQUFBLEdBQVMsTUFBQSxLQUFVLENBQWIsR0FBb0IsUUFBcEIsR0FBa0MsU0FEeEMsQ0FBQTthQUVBLDBCQUFBLEdBQTZCLE1BQTdCLEdBQXNDLEdBQXRDLEdBQTRDLGtDQUh4QztJQUFBLENBRFIsQ0F6QkEsQ0FBQTtXQThCQSxJQUFJLENBQUMsTUFBTCxDQUFZLEdBQVosQ0FBZ0IsQ0FBQyxJQUFqQixDQUFzQixTQUFDLENBQUQsRUFBRyxDQUFILEdBQUE7QUFDbEIsVUFBQSxvQ0FBQTtBQUFBLE1BQUEsU0FBQSxHQUFZLENBQUMsQ0FBQyxJQUFGLENBQU8sQ0FBQyxDQUFDLEtBQVQsRUFBZSxDQUFmLENBQVosQ0FBQTtBQUFBLE1BQ0EsU0FBQSxHQUFZLENBQUMsQ0FBQyxJQUFGLENBQU8sQ0FBQyxDQUFDLEtBQVQsRUFBZSxDQUFmLENBRFosQ0FBQTtBQUFBLE1BRUEsSUFBQSxHQUFNLFNBQVUsQ0FBQSxDQUFBLENBQVYsR0FBZSxTQUFVLENBQUEsQ0FBQSxDQUYvQixDQUFBO0FBQUEsTUFHQSxRQUFBLEdBQVcsQ0FBQyxFQUFELEVBQUksRUFBSixFQUFPLEVBQVAsRUFBVSxJQUFWLEVBQWUsRUFBZixFQUFrQixTQUFsQixFQUE0QixFQUE1QixDQUhYLENBQUE7QUFBQSxNQUlBLFFBQVMsQ0FBQSxDQUFBLENBQVQsR0FBaUIsQ0FBQyxJQUFJLENBQUMsR0FBTCxDQUFTLElBQVQsQ0FBRCxDQUFBLEtBQW1CLENBQXRCLEdBQTZCLFdBQTdCLEdBQThDLFlBSjVELENBQUE7QUFBQSxNQUtBLFFBQVMsQ0FBQSxDQUFBLENBQVQsR0FBYyxJQUFJLENBQUMsR0FBTCxDQUFTLElBQVQsQ0FMZCxDQUFBO0FBQUEsTUFNQSxRQUFTLENBQUEsQ0FBQSxDQUFULEdBQWlCLElBQUEsR0FBTyxDQUFWLEdBQWlCLE1BQWpCLEdBQTZCLE9BTjNDLENBQUE7QUFBQSxNQU9BLFFBQVMsQ0FBQSxDQUFBLENBQVQsR0FBYyxRQUFBLENBQVMsU0FBVSxDQUFBLENBQUEsQ0FBbkIsRUFBc0IsS0FBdEIsQ0FQZCxDQUFBO0FBQUEsTUFRQSxRQUFTLENBQUEsQ0FBQSxDQUFULEdBQWMsUUFBQSxDQUFVLFNBQVUsQ0FBQSxDQUFBLENBQXBCLEVBQXVCLEtBQXZCLENBQUEsR0FBZ0MsR0FSOUMsQ0FBQTthQVNBLFFBQVEsQ0FBQyxJQUFULENBQWMsR0FBZCxFQVZrQjtJQUFBLENBQXRCLEVBaENJO0VBQUEsQ0FEUixFQTNCSTtBQUFBLENBbkVSLENBQUE7O0FBQUEsQ0EySUEsQ0FBRSxRQUFGLENBQVcsQ0FBQyxLQUFaLENBQWtCLFNBQUEsR0FBQTtBQUNoQixNQUFBLFFBQUE7QUFBQSxFQUFBLFFBQUEsR0FBVSxvQ0FBQSxHQUF1QyxrQkFBQSxDQUFtQiwyREFBbkIsQ0FBdkMsR0FBeUgsYUFBbkksQ0FBQTtTQUNBLENBQUMsQ0FBQyxPQUFGLENBQVUsUUFBVixFQUFvQixLQUFwQixFQUZnQjtBQUFBLENBQWxCLENBM0lBLENBQUEiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlUm9vdCI6Ii9zb3VyY2UvIiwic291cmNlc0NvbnRlbnQiOlsiIyBjb3BpZWQgZnJvbSBodHRwOi8vd3d3LmNhbGljb3dlYmRldi5jb20vMjAxMS8wNS8wMS9zaW1wbGUtY29mZmVlc2NyaXB0LWludHJvZHVjdGlvbi9cbmNsYXNzIEV4dE1hdGggZXh0ZW5kcyBNYXRoXG4gIEB0cnVuY2F0ZSA9ICh4LCBwcmVjaXNpb24gPSAwKSAtPlxuICAgIHNjYWxlcyA9IFsxLCAxMCwgMTAwLCAxMDAwLCAxMDAwMCwgMTAwMDAwLCAxMDAwMDAwLCAxMDAwMDAwMCwgMTAwMDAwMDAwXVxuICAgIHNjYWxlID0gc2NhbGVzW3ByZWNpc2lvbl1cbiAgICBNYXRoLnJvdW5kKHggKiBzY2FsZSkgLyBzY2FsZVxuXG4jIHNwYXJrbGluZSBhZGFwdGVkIGZyb20gaHR0cDovL3d3dy50bm9kYS5jb20vYmxvZy8yMDEzLTEyLTE5XG53aWR0aCA9IDk2XG5oZWlnaHQgPSA2NFxueCA9IGQzLnNjYWxlLmxpbmVhcigpLnJhbmdlKFswLCB3aWR0aCAtIDJdKVxueSA9IGQzLnNjYWxlLmxpbmVhcigpLnJhbmdlKFtoZWlnaHQgLSA0LCAwXSlcbnBhcnNlRGF0ZSA9IGQzLnRpbWUuZm9ybWF0KFwiJVktJW0tJWRcIikucGFyc2VcblxubGluZSA9IGQzLnN2Zy5saW5lKClcbiAgLmludGVycG9sYXRlKFwiYmFzaXNcIilcbiAgLngoIChkKSAtPiB4KCBkWzBdICkgKVxuICAueSggKGQpIC0+IHkoIGRbMV0gKSApXG5cbnNwYXJrbGluZSA9IChnLCBkYXRhKSAtPlxuICBcbiAgaWYgZGF0YS5sZW5ndGggPiAwXG4gICAgZy5hcHBlbmQoJ3BhdGgnKVxuICAgICAgLmRhdHVtKGRhdGEpXG4gICAgICAuY2xhc3NlZCgnc3BhcmtsaW5lJyx0cnVlKVxuICAgICAgLmF0dHIoJ2QnLCBsaW5lKVxuXG4gICAgZy5hcHBlbmQoJ2NpcmNsZScpXG4gICAgICAuY2xhc3NlZCgnc3BhcmtjaXJjbGUnLHRydWUpXG4gICAgICAuYXR0cignY3gnLCAtPiB4KCBfLmxhc3QoZGF0YSlbMF0gKSApXG4gICAgICAuYXR0cignY3knLCAtPiB5KCBfLmxhc3QoZGF0YSlbMV0gKSApXG4gICAgICAuYXR0cigncicsIDEuNSlcblxuRGF0ZVV0aWwgPSAoSlNkYXRlLHR5cGUpLT5cbiAgaWYgSlNkYXRlXG4gICAgc3dpdGNoIHR5cGVcbiAgICAgIHdoZW4gXCJNL0RcIiB0aGVuIChKU2RhdGUuZ2V0TW9udGgoKSArIDEpICsgXCIvXCIgKyBKU2RhdGUuZ2V0RGF0ZSgpXG5cbmNsYXNzIFN1bW1hcnlcbiAgY29uc3RydWN0b3I6LT5cbiAgICBAbmFtZSA9XCJcIiAgXG4gICAgQGNhbGxzPVtdXG4gICAgQGRhdGVzPVtdXG4gIHN1bSA6IChkYXlzKS0+XG4gICAgZGF5cyA/PSBAY2FsbHNcbiAgICBpZiBAY2FsbHMubGVuZ3RoID4gMFxuICAgICAgXy5yZWR1Y2UgZGF5cywobWVtbywgbnVtKSAtPiBtZW1vICsgbnVtXG4gICAgZWxzZVxuICAgICAgMFxuICBtYXggOiAtPiBfLnJlZHVjZSBAY2FsbHMsKG0sbiktPiBpZiBuPm0gdGhlbiBuIGVsc2UgbVxuICBtaW4gOiAtPiBfLnJlZHVjZSBAY2FsbHMsKG0sbiktPiBpZiBuPG0gdGhlbiBuIGVsc2UgbVxuICBhdmcgOiAobW92aW5nKS0+XG4gICAgcGFzdGRheXMgPSBfLmxhc3QoQGNhbGxzLG1vdmluZylcbiAgICBFeHRNYXRoLnRydW5jYXRlIEBzdW0ocGFzdGRheXMpIC8gcGFzdGRheXMubGVuZ3RoLDFcbiAgYWRkOiAocG9pbnRzKS0+XG4gICAgaXRlciA9IChlLGksbCktPlxuICAgICAgZGF0ZV9wb3MgPSBfLnNvcnRlZEluZGV4KEBkYXRlcyxlWzBdKVxuICAgICAgZGF0ZSA9IEBkYXRlc1tkYXRlX3Bvc10gPyAwXG4gICAgICBpZiBlWzBdLnZhbHVlT2YoKSBpc250IGRhdGUudmFsdWVPZigpXG4gICAgICAgIEBkYXRlcz0gXy5maXJzdChAZGF0ZXMsZGF0ZV9wb3MpLmNvbmNhdCAgW2VbMF1dICwgXy5yZXN0KEBkYXRlcyxkYXRlX3BvcylcbiAgICAgICAgQGNhbGxzPSBfLmZpcnN0KEBjYWxscyxkYXRlX3BvcykuY29uY2F0ICBbMF0gLCBfLnJlc3QoQGNhbGxzLGRhdGVfcG9zKVxuICAgICAgQGNhbGxzW2RhdGVfcG9zXSAgKz0gZVsxXVxuICAgIF8uZWFjaCBwb2ludHMsaXRlcixAXG4gIHBvaW50czogLT5cbiAgICBfLnppcCBAZGF0ZXMsQGNhbGxzXG5cblxuXG5idWlsZCA9IChkYXRhKS0+XG4gICAgY29uc29sZS5sb2coZGF0YSlcbiAgICB0b3RhbF9jYWxscz0gbmV3IFN1bW1hcnkgICAgICAgIFxuICAgIHRvdGFsX2NhbGxzLm5hbWUgPVwiQUxMXCJcbiAgICBcbiAgICBkaXNwbGF5ID0gXy5tYXAoZGF0YS5jb250ZW50cy5kYXRhLFxuICAgICAgKHYsaSxsKS0+XG4gICAgICAgIGRhdGVzID0gXy5tYXAodi54LCAodixpLGwpIC0+IHBhcnNlRGF0ZSB2ICkgXG4gICAgICAgIGNhbGxzID0gXy5tYXAodi55LCAodixpLGwpIC0+IHYtbFtpLTFdPz0wICkgIFxuICAgICAgICB0aGlzX3N0YXRlID0gbmV3IFN1bW1hcnlcbiAgICAgICAgdGhpc19zdGF0ZS5uYW1lID0gdi5uYW1lXG4gICAgICAgIHRoaXNfc3RhdGUuYWRkKF8uemlwKGRhdGVzLGNhbGxzKSkgICAgICAgICAgICAgIFxuICAgICAgICB0b3RhbF9jYWxscy5hZGQgdGhpc19zdGF0ZS5wb2ludHMoKVxuICAgICAgICB0aGlzX3N0YXRlXG4gICAgKVxuICAgIFxuICAgIGRpc3BsYXkudW5zaGlmdCB0b3RhbF9jYWxsc1xuICAgIFxuICAgIG1lZGlhX2xpID0gZDMuc2VsZWN0KCcjcHJvZ3JhbXMnKVxuICAgICAgLnNlbGVjdEFsbCgnbGknKVxuICAgICAgLmRhdGEoZGlzcGxheSlcbiAgICAgIC5lbnRlcigpXG4gICAgICAuYXBwZW5kKFwibGlcIilcbiAgICAgICAgLmNsYXNzZWQoXCJsaXN0LWdyb3VwLWl0ZW1cIix0cnVlKVxuICAgICAgLmFwcGVuZChcImRpdlwiKVxuICAgICAgICAuY2xhc3NlZChcIm1lZGlhXCIsdHJ1ZSlcblxuICAgIG1lZGlhX2xpIFxuICAgICAgLmVhY2ggKGQsaSktPlxuXG4gICAgICAgIHguZG9tYWluIGQzLmV4dGVudCBkLmRhdGVzIFxuICAgICAgICB5LmRvbWFpbiBkMy5leHRlbnQgZC5jYWxscyAgXG5cbiAgICAgICAgbWVkaWEgPSBkMy5zZWxlY3QgQFxuXG4gICAgICAgIHN2ZyA9IG1lZGlhLmFwcGVuZChcImRpdlwiKVxuICAgICAgICAgIC5jbGFzc2VkKFwicHVsbC1sZWZ0XCIsdHJ1ZSlcbiAgICAgICAgICAuYXBwZW5kKCdzdmcnKVxuICAgICAgICAgICAgLmNsYXNzZWQoXCJtZWRpYS1vYmplY3RcIix0cnVlKVxuICAgICAgICAgICAgLmF0dHIoJ3dpZHRoJywgd2lkdGgpXG4gICAgICAgICAgICAuYXR0cignaGVpZ2h0JywgaGVpZ2h0KVxuICAgICAgICAgICAgLmFwcGVuZCgnZycpXG4gICAgICAgICAgICAgIC5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKDAsIDIpJyk7XG5cbiAgICAgICAgc3BhcmtsaW5lIHN2ZywgZC5wb2ludHMoKVxuICAgICAgICBcbiAgICAgICAgYm9keSA9IG1lZGlhIC5hcHBlbmQoJ2RpdicpXG4gICAgICAgICAgLmNsYXNzZWQoXCJtZWRpYS1ib2R5XCIsdHJ1ZSlcbiAgICAgICAgYm9keS5hcHBlbmQoJ2g0JylcbiAgICAgICAgICAuY2xhc3NlZChcIm1lZGlhLWhlYWRpbmdcIix0cnVlKVxuICAgICAgICAgIC50ZXh0IChkLGkpLT5kLm5hbWVcbiAgICAgICAgYm9keS5hcHBlbmQoJ3AnKVxuICAgICAgICAgIC50ZXh0IChkLGkpLT4gXG4gICAgICAgICAgICBsYXN0ZGF0ZT1fLmxhc3QoZC5kYXRlcylcbiAgICAgICAgICAgIFwiVGhlcmUgaGF2ZSBiZWVuIFwiICsgZC5zdW0oKSArIFwiIGJhbGFuY2UgY2hlY2tzIHNpbmNlIFwiICsgRGF0ZVV0aWwobGFzdGRhdGUsXCJNL0RcIikgKyBcIi5cIlxuICAgICAgICBib2R5LmFwcGVuZCgncCcpXG4gICAgICAgICAgLnRleHQgKGQsaSktPlxuICAgICAgICAgICAgdGVuZGF5ID0gZC5hdmcoMTApXG4gICAgICAgICAgICBjaGsgPSBpZiB0ZW5kYXkgaXMgMSB0aGVuIFwiIGNoZWNrXCIgZWxzZSBcIiBjaGVja3NcIlxuICAgICAgICAgICAgXCJUaGVyZSBpcyBhbiBhdmVyYWdlIG9mICBcIiArIHRlbmRheSArIGNoayArIFwiIHBlciBkYXkgb3ZlciB0aGUgcGFzdCAxMCBkYXlzLlwiXG4gICAgICAgIGJvZHkuYXBwZW5kKCdwJykudGV4dCAoZCxpKS0+XG4gICAgICAgICAgICBsYXN0Y2FsbHMgPSBfLmxhc3QoZC5jYWxscywyKVxuICAgICAgICAgICAgbGFzdGRhdGVzID0gXy5sYXN0KGQuZGF0ZXMsMilcbiAgICAgICAgICAgIGRpZmY9IGxhc3RjYWxsc1sxXSAtIGxhc3RjYWxsc1swXVxuICAgICAgICAgICAgc2VudGVuY2UgPSBbXCJcIixcIlwiLFwiXCIsXCJvblwiLFwiXCIsXCJ0aGFuIG9uXCIsXCJcIl1cbiAgICAgICAgICAgIHNlbnRlbmNlWzBdID0gaWYgKE1hdGguYWJzIGRpZmYpIGlzIDEgdGhlbiBcIlRoZXJlIHdhc1wiIGVsc2UgXCJUaGVyZSB3ZXJlXCJcbiAgICAgICAgICAgIHNlbnRlbmNlWzFdID0gTWF0aC5hYnMgZGlmZlxuICAgICAgICAgICAgc2VudGVuY2VbMl0gPSBpZiBkaWZmID4gMCB0aGVuIFwibW9yZVwiIGVsc2UgXCJmZXdlclwiIFxuICAgICAgICAgICAgc2VudGVuY2VbNF0gPSBEYXRlVXRpbCBsYXN0ZGF0ZXNbMV0sXCJNL0RcIlxuICAgICAgICAgICAgc2VudGVuY2VbNl0gPSBEYXRlVXRpbCggbGFzdGRhdGVzWzBdLFwiTS9EXCIgKSsgXCIuXCJcbiAgICAgICAgICAgIHNlbnRlbmNlLmpvaW4gXCIgXCJcbiAgICAgICAgICAgIFxuJChkb2N1bWVudCkucmVhZHkgLT5cbiAgZGF0YV91cmwgPSdodHRwOi8vd2hhdGV2ZXJvcmlnaW4ub3JnL2dldD91cmw9JyArIGVuY29kZVVSSUNvbXBvbmVudCgnaHR0cHM6Ly9wbG90Lmx5L35saXBweXRhay8xODQvYmFsYW5jZS1tZXRyaWNzLWNoZWNrcy5qc29uJykgKyAnJmNhbGxiYWNrPT8nIFxuICAkLmdldEpTT04gZGF0YV91cmwgLGJ1aWxkXG5cbiJdfQ==